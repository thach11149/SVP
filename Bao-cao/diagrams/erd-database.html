<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERD - Database Schema</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <style>
        /* ERD specific styles */
        .erd-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            font-family: Arial, sans-serif;
            background: white;
            padding: 20px;
        }
        
        .erd-diagram {
            position: relative;
            width: 100%;
            height: 900px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: visible;
        }
        
        .table-entity {
            position: absolute;
            background: white;
            border: 2px solid #2c3e50;
            border-radius: 8px;
            min-width: 180px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .table-header {
            background: #3498db;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            text-align: center;
            border-radius: 6px 6px 0 0;
            font-size: 14px;
        }
        
        .table-field {
            padding: 4px 12px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
        }
        
        .table-field:last-child {
            border-bottom: none;
        }
        
        .field-name {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .field-type {
            color: #7f8c8d;
            font-style: italic;
        }
        
        .primary-key {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .foreign-key {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }
        
        .relationship-line {
            stroke: #e74c3c;
            stroke-width: 2;
            fill: none;
        }
        
        .relationship-label {
            position: absolute;
            background: white;
            padding: 2px 6px;
            border: 1px solid #e74c3c;
            border-radius: 4px;
            font-size: 10px;
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="erd-container">
        <div class="dfd-title">Entity Relationship Diagram - Hệ thống Quản lý Phun thuốc Diệt côn trùng</div>
        
        <div class="erd-diagram">
            <!-- Users Table -->
            <div class="table-entity" style="top: 50px; left: 50px;">
                <div class="table-header">users</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">email</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">phone</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">full_name</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">role</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">status</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">created_at</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
            </div>

            <!-- Customers Table -->
            <div class="table-entity" style="top: 50px; left: 300px;">
                <div class="table-header">customers</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">name</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">phone</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">email</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">address</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">service_type</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">created_at</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
            </div>

            <!-- Jobs Table -->
            <div class="table-entity" style="top: 300px; left: 180px;">
                <div class="table-header">jobs</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">customer_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">assigned_to</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">created_by</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">title</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">description</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">scheduled_date</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
                <div class="table-field">
                    <span class="field-name">status</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">priority</span>
                    <span class="field-type">ENUM</span>
                </div>
            </div>

            <!-- Job Reports Table -->
            <div class="table-entity" style="top: 300px; left: 450px;">
                <div class="table-header">job_reports</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">job_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">technician_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">check_in_time</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
                <div class="table-field">
                    <span class="field-name">check_out_time</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
                <div class="table-field">
                    <span class="field-name">work_description</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">images</span>
                    <span class="field-type">JSON</span>
                </div>
                <div class="table-field">
                    <span class="field-name">gps_location</span>
                    <span class="field-type">POINT</span>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="table-entity" style="top: 50px; left: 600px;">
                <div class="table-header">inventory</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">item_name</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">category</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">unit</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">current_stock</span>
                    <span class="field-type">INTEGER</span>
                </div>
                <div class="table-field">
                    <span class="field-name">min_threshold</span>
                    <span class="field-type">INTEGER</span>
                </div>
                <div class="table-field">
                    <span class="field-name">unit_price</span>
                    <span class="field-type">DECIMAL</span>
                </div>
            </div>

            <!-- Inventory Transactions Table -->
            <div class="table-entity" style="top: 300px; left: 750px;">
                <div class="table-header">inventory_transactions</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">inventory_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">user_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">transaction_type</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">quantity</span>
                    <span class="field-type">INTEGER</span>
                </div>
                <div class="table-field">
                    <span class="field-name">notes</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">transaction_date</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
            </div>

            <!-- Expenses Table -->
            <div class="table-entity" style="top: 550px; left: 180px;">
                <div class="table-header">expenses</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">job_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">technician_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">expense_type</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">amount</span>
                    <span class="field-type">DECIMAL</span>
                </div>
                <div class="table-field">
                    <span class="field-name">description</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">receipt_image</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">expense_date</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
            </div>

            <!-- Schedules Table -->
            <div class="table-entity" style="top: 550px; left: 450px;">
                <div class="table-header">schedules</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">technician_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">job_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">date</span>
                    <span class="field-type">DATE</span>
                </div>
                <div class="table-field">
                    <span class="field-name">start_time</span>
                    <span class="field-type">TIME</span>
                </div>
                <div class="table-field">
                    <span class="field-name">end_time</span>
                    <span class="field-type">TIME</span>
                </div>
                <div class="table-field">
                    <span class="field-name">status</span>
                    <span class="field-type">ENUM</span>
                </div>
            </div>

            <!-- Notifications Table -->
            <div class="table-entity" style="top: 550px; left: 750px;">
                <div class="table-header">notifications</div>
                <div class="table-field primary-key">
                    <span class="field-name">id</span>
                    <span class="field-type">UUID (PK)</span>
                </div>
                <div class="table-field foreign-key">
                    <span class="field-name">user_id</span>
                    <span class="field-type">UUID (FK)</span>
                </div>
                <div class="table-field">
                    <span class="field-name">title</span>
                    <span class="field-type">VARCHAR</span>
                </div>
                <div class="table-field">
                    <span class="field-name">message</span>
                    <span class="field-type">TEXT</span>
                </div>
                <div class="table-field">
                    <span class="field-name">type</span>
                    <span class="field-type">ENUM</span>
                </div>
                <div class="table-field">
                    <span class="field-name">is_read</span>
                    <span class="field-type">BOOLEAN</span>
                </div>
                <div class="table-field">
                    <span class="field-name">created_at</span>
                    <span class="field-type">TIMESTAMP</span>
                </div>
            </div>

            <!-- SVG for relationships -->
            <svg class="arrow-svg">
                <!-- Users to Jobs (created_by) -->
                <line x1="230" y1="150" x2="260" y2="320" class="relationship-line"/>
                
                <!-- Users to Jobs (assigned_to) -->
                <line x1="150" y1="250" x2="260" y2="350" class="relationship-line"/>
                
                <!-- Customers to Jobs -->
                <line x1="380" y1="250" x2="350" y2="320" class="relationship-line"/>
                
                <!-- Jobs to Job Reports -->
                <line x1="410" y1="400" x2="450" y2="400" class="relationship-line"/>
                
                <!-- Users to Job Reports (technician) -->
                <line x1="230" y1="180" x2="530" y2="350" class="relationship-line"/>
                
                <!-- Inventory to Inventory Transactions -->
                <line x1="700" y1="250" x2="750" y2="350" class="relationship-line"/>
                
                <!-- Users to Inventory Transactions -->
                <line x1="230" y1="200" x2="830" y2="350" class="relationship-line"/>
                
                <!-- Jobs to Expenses -->
                <line x1="300" y1="500" x2="260" y2="550" class="relationship-line"/>
                
                <!-- Users to Expenses (technician) -->
                <line x1="150" y1="280" x2="260" y2="600" class="relationship-line"/>
                
                <!-- Users to Schedules (technician) -->
                <line x1="180" y1="300" x2="450" y2="600" class="relationship-line"/>
                
                <!-- Jobs to Schedules -->
                <line x1="350" y1="500" x2="500" y2="550" class="relationship-line"/>
                
                <!-- Users to Notifications -->
                <line x1="230" y1="220" x2="750" y2="600" class="relationship-line"/>
            </svg>

            <!-- Relationship Labels -->
            <div class="relationship-label" style="top: 230px; left: 240px;">1:N</div>
            <div class="relationship-label" style="top: 280px; left: 200px;">1:N</div>
            <div class="relationship-label" style="top: 280px; left: 360px;">1:N</div>
            <div class="relationship-label" style="top: 400px; left: 420px;">1:1</div>
            <div class="relationship-label" style="top: 280px; left: 380px;">1:N</div>
            <div class="relationship-label" style="top: 300px; left: 720px;">1:N</div>
            <div class="relationship-label" style="top: 250px; left: 530px;">1:N</div>
            <div class="relationship-label" style="top: 520px; left: 280px;">1:N</div>
            <div class="relationship-label" style="top: 440px; left: 200px;">1:N</div>
            <div class="relationship-label" style="top: 450px; left: 320px;">1:N</div>
            <div class="relationship-label" style="top: 570px; left: 470px;">1:N</div>
            <div class="relationship-label" style="top: 410px; left: 490px;">1:N</div>
        </div>
        
        <div style="margin-top: 30px; font-size: 14px; line-height: 1.6;">
            <h3>Mô tả các bảng dữ liệu:</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h4>Nhóm Quản lý Người dùng:</h4>
                    <ul>
                        <li><strong>users:</strong> Lưu trữ thông tin tất cả người dùng hệ thống (Admin, Leader, CSKH, KTV)</li>
                        <li><strong>customers:</strong> Lưu trữ thông tin khách hàng sử dụng dịch vụ</li>
                        <li><strong>notifications:</strong> Hệ thống thông báo cho người dùng</li>
                    </ul>
                    
                    <h4>Nhóm Quản lý Công việc:</h4>
                    <ul>
                        <li><strong>jobs:</strong> Lưu trữ thông tin công việc được tạo và phân công</li>
                        <li><strong>job_reports:</strong> Báo cáo chi tiết từ KTV sau khi hoàn thành công việc</li>
                        <li><strong>schedules:</strong> Lịch làm việc và phân công chi tiết theo thời gian</li>
                    </ul>
                </div>
                
                <div>
                    <h4>Nhóm Quản lý Kho:</h4>
                    <ul>
                        <li><strong>inventory:</strong> Danh mục vật tư, thuốc trừ sâu trong kho</li>
                        <li><strong>inventory_transactions:</strong> Lịch sử xuất nhập kho</li>
                    </ul>
                    
                    <h4>Nhóm Quản lý Tài chính:</h4>
                    <ul>
                        <li><strong>expenses:</strong> Quản lý công tác phí và chi phí của KTV</li>
                    </ul>
                    
                    <h4>Quan hệ chính:</h4>
                    <ul>
                        <li>Users (1) ←→ (N) Jobs: Một user có thể tạo/được giao nhiều job</li>
                        <li>Customers (1) ←→ (N) Jobs: Một khách hàng có thể có nhiều job</li>
                        <li>Jobs (1) ←→ (1) Job_Reports: Mỗi job có một báo cáo</li>
                        <li>Inventory (1) ←→ (N) Inventory_Transactions: Theo dõi xuất nhập</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
